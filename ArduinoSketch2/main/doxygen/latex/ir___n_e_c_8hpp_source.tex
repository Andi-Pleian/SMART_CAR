\hypertarget{ir___n_e_c_8hpp_source}{}\doxysection{ir\+\_\+\+NEC.\+hpp}
\label{ir___n_e_c_8hpp_source}\index{IRRemote/ir\_NEC.hpp@{IRRemote/ir\_NEC.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * ir\_NEC.hpp}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Contains functions for receiving and sending NEC IR Protocol in "{}raw"{} and standard format with 16 or 8 bit address and 8 bit command}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ *  This file is part of Arduino-\/IRremote https://github.com/Arduino-\/IRremote/Arduino-\/IRremote.}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ ************************************************************************************}}
\DoxyCodeLine{9 \textcolor{comment}{ * MIT License}}
\DoxyCodeLine{10 \textcolor{comment}{ *}}
\DoxyCodeLine{11 \textcolor{comment}{ * Copyright (c) 2020-\/2021 Armin Joachimsmeyer}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * Permission is hereby granted, free of charge, to any person obtaining a copy}}
\DoxyCodeLine{14 \textcolor{comment}{ * of this software and associated documentation files (the "{}Software"{}), to deal}}
\DoxyCodeLine{15 \textcolor{comment}{ * in the Software without restriction, including without limitation the rights}}
\DoxyCodeLine{16 \textcolor{comment}{ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}}
\DoxyCodeLine{17 \textcolor{comment}{ * copies of the Software, and to permit persons to whom the Software is furnished}}
\DoxyCodeLine{18 \textcolor{comment}{ * to do so, subject to the following conditions:}}
\DoxyCodeLine{19 \textcolor{comment}{ *}}
\DoxyCodeLine{20 \textcolor{comment}{ * The above copyright notice and this permission notice shall be included in all}}
\DoxyCodeLine{21 \textcolor{comment}{ * copies or substantial portions of the Software.}}
\DoxyCodeLine{22 \textcolor{comment}{ *}}
\DoxyCodeLine{23 \textcolor{comment}{ * THE SOFTWARE IS PROVIDED "{}AS IS"{}, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,}}
\DoxyCodeLine{24 \textcolor{comment}{ * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A}}
\DoxyCodeLine{25 \textcolor{comment}{ * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT}}
\DoxyCodeLine{26 \textcolor{comment}{ * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF}}
\DoxyCodeLine{27 \textcolor{comment}{ * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE}}
\DoxyCodeLine{28 \textcolor{comment}{ * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.}}
\DoxyCodeLine{29 \textcolor{comment}{ *}}
\DoxyCodeLine{30 \textcolor{comment}{ ************************************************************************************}}
\DoxyCodeLine{31 \textcolor{comment}{ */}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#ifndef IR\_NEC\_HPP}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define IR\_NEC\_HPP}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{comment}{//\#define DEBUG // Activate this for lots of lovely debug output from this decoder.}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_rremote_int_8h}{IRremoteInt.h}}"{}} \textcolor{comment}{// evaluates the DEBUG for IR\_DEBUG\_PRINT}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}LongUnion.h"{}}}
\DoxyCodeLine{40 }
\DoxyCodeLine{44 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{45 \textcolor{comment}{//                           N   N  EEEEE   CCCC}}
\DoxyCodeLine{46 \textcolor{comment}{//                           NN  N  E      C}}
\DoxyCodeLine{47 \textcolor{comment}{//                           N N N  EEE    C}}
\DoxyCodeLine{48 \textcolor{comment}{//                           N  NN  E      C}}
\DoxyCodeLine{49 \textcolor{comment}{//                           N   N  EEEEE   CCCC}}
\DoxyCodeLine{50 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{51 \textcolor{comment}{// see: https://www.sbprojects.net/knowledge/ir/nec.php}}
\DoxyCodeLine{52 \textcolor{comment}{// for Apple see https://en.wikipedia.org/wiki/Apple\_Remote}}
\DoxyCodeLine{53 \textcolor{comment}{// ONKYO like NEC but 16 independent command bits}}
\DoxyCodeLine{54 \textcolor{comment}{// LSB first, 1 start bit + 16 bit address + 8 bit command + 8 bit inverted command + 1 stop bit.}}
\DoxyCodeLine{55 \textcolor{comment}{//}}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#define NEC\_ADDRESS\_BITS        16 }\textcolor{comment}{// 16 bit address or 8 bit address and 8 bit inverted address}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#define NEC\_COMMAND\_BITS        16 }\textcolor{comment}{// Command and inverted command}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{preprocessor}{\#define NEC\_BITS                (NEC\_ADDRESS\_BITS + NEC\_COMMAND\_BITS)}}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#define NEC\_UNIT                560 }\textcolor{comment}{// 21.28 periods of 38 kHz}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{preprocessor}{\#define NEC\_HEADER\_MARK         (16 * NEC\_UNIT) }\textcolor{comment}{// 9000}}
\DoxyCodeLine{63 \textcolor{preprocessor}{\#define NEC\_HEADER\_SPACE        (8 * NEC\_UNIT)  }\textcolor{comment}{// 4500}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{preprocessor}{\#define NEC\_BIT\_MARK            NEC\_UNIT}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#define NEC\_ONE\_SPACE           (3 * NEC\_UNIT)  }\textcolor{comment}{// 1690}}
\DoxyCodeLine{67 \textcolor{preprocessor}{\#define NEC\_ZERO\_SPACE          NEC\_UNIT}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{preprocessor}{\#define NEC\_REPEAT\_HEADER\_SPACE (4 * NEC\_UNIT)  }\textcolor{comment}{// 2250}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{preprocessor}{\#define NEC\_AVERAGE\_DURATION    62000 }\textcolor{comment}{// NEC\_HEADER\_MARK + NEC\_HEADER\_SPACE + 32 * 2,5 * NEC\_UNIT + NEC\_UNIT // 2.5 because we assume more zeros than ones}}
\DoxyCodeLine{72 \textcolor{preprocessor}{\#define NEC\_REPEAT\_DURATION     (NEC\_HEADER\_MARK  + NEC\_REPEAT\_HEADER\_SPACE + NEC\_BIT\_MARK) }\textcolor{comment}{// 12 ms}}
\DoxyCodeLine{73 \textcolor{preprocessor}{\#define NEC\_REPEAT\_PERIOD       110000 }\textcolor{comment}{// Commands are repeated every 110 ms (measured from start to start) for as long as the key on the remote control is held down.}}
\DoxyCodeLine{74 \textcolor{preprocessor}{\#define NEC\_REPEAT\_SPACE        (NEC\_REPEAT\_PERIOD -\/ NEC\_AVERAGE\_DURATION) }\textcolor{comment}{// 48 ms}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76 \textcolor{preprocessor}{\#define APPLE\_ADDRESS           0x87EE}}
\DoxyCodeLine{77 \textcolor{comment}{//+=============================================================================}}
\DoxyCodeLine{78 \textcolor{comment}{/*}}
\DoxyCodeLine{79 \textcolor{comment}{ * Send repeat}}
\DoxyCodeLine{80 \textcolor{comment}{ * Repeat commands should be sent in a 110 ms raster.}}
\DoxyCodeLine{81 \textcolor{comment}{ */}}
\DoxyCodeLine{82 \textcolor{keywordtype}{void} IRsend::sendNECRepeat() \{}
\DoxyCodeLine{83     \mbox{\hyperlink{group___sending_ga42c04af63d252b320c017ffa2bfc90e5}{enableIROut}}(NEC\_KHZ); \textcolor{comment}{// 38 kHz}}
\DoxyCodeLine{84     \mbox{\hyperlink{group___sending_ga7328943560a5f60f4e9e13d677716674}{mark}}(NEC\_HEADER\_MARK);}
\DoxyCodeLine{85     \mbox{\hyperlink{group___sending_ga6a653dc4b2f718ce16a2ae87abdc2527}{space}}(NEC\_REPEAT\_HEADER\_SPACE);}
\DoxyCodeLine{86     \mbox{\hyperlink{group___sending_ga7328943560a5f60f4e9e13d677716674}{mark}}(NEC\_BIT\_MARK);}
\DoxyCodeLine{87 \textcolor{comment}{//    ledOff(); // Always end with the LED off}}
\DoxyCodeLine{88 \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{/*}}
\DoxyCodeLine{91 \textcolor{comment}{ * Repeat commands should be sent in a 110 ms raster.}}
\DoxyCodeLine{92 \textcolor{comment}{ * There is NO delay after the last sent repeat!}}
\DoxyCodeLine{93 \textcolor{comment}{ * https://www.sbprojects.net/knowledge/ir/nec.php}}
\DoxyCodeLine{94 \textcolor{comment}{ * @param aIsRepeat if true, send only one repeat frame without leading and trailing space}}
\DoxyCodeLine{95 \textcolor{comment}{ */}}
\DoxyCodeLine{96 \textcolor{keywordtype}{void} IRsend::sendNEC(uint16\_t aAddress, uint8\_t aCommand, uint\_fast8\_t aNumberOfRepeats, \textcolor{keywordtype}{bool} aIsRepeat) \{}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \mbox{\hyperlink{union_long_union}{LongUnion}} tRawData;}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{comment}{// Address 16 bit LSB first}}
\DoxyCodeLine{101     \textcolor{keywordflow}{if} ((aAddress \& 0xFF00) == 0) \{}
\DoxyCodeLine{102         \textcolor{comment}{// assume 8 bit address -\/> send 8 address bits and then 8 inverted address bits LSB first}}
\DoxyCodeLine{103         tRawData.UByte.LowByte = aAddress;}
\DoxyCodeLine{104         tRawData.UByte.MidLowByte = \string~tRawData.UByte.LowByte;}
\DoxyCodeLine{105     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{106         tRawData.UWord.LowWord = aAddress;}
\DoxyCodeLine{107     \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     \textcolor{comment}{// send 8 command bits and then 8 inverted command bits LSB first}}
\DoxyCodeLine{110     tRawData.UByte.MidHighByte = aCommand;}
\DoxyCodeLine{111     tRawData.UByte.HighByte = \string~aCommand;}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     sendNECRaw(tRawData.ULong, aNumberOfRepeats, aIsRepeat);}
\DoxyCodeLine{114 \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{comment}{/*}}
\DoxyCodeLine{117 \textcolor{comment}{ * Repeat commands should be sent in a 110 ms raster.}}
\DoxyCodeLine{118 \textcolor{comment}{ * There is NO delay after the last sent repeat!}}
\DoxyCodeLine{119 \textcolor{comment}{ * @param aIsRepeat if true, send only one repeat frame without leading and trailing space}}
\DoxyCodeLine{120 \textcolor{comment}{ */}}
\DoxyCodeLine{121 \textcolor{keywordtype}{void} IRsend::sendOnkyo(uint16\_t aAddress, uint16\_t aCommand, uint\_fast8\_t aNumberOfRepeats, \textcolor{keywordtype}{bool} aIsRepeat) \{}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \mbox{\hyperlink{union_long_union}{LongUnion}} tRawData;}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{// Address 16 bit LSB first}}
\DoxyCodeLine{126     tRawData.UWord.LowWord = aAddress;}
\DoxyCodeLine{127     \textcolor{comment}{// Command 16 bit LSB first}}
\DoxyCodeLine{128     tRawData.UWord.HighWord = aCommand;}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     sendNECRaw(tRawData.ULong, aNumberOfRepeats, aIsRepeat);}
\DoxyCodeLine{131 \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133 \textcolor{comment}{/*}}
\DoxyCodeLine{134 \textcolor{comment}{ * Repeat commands should be sent in a 110 ms raster.}}
\DoxyCodeLine{135 \textcolor{comment}{ * There is NO delay after the last sent repeat!}}
\DoxyCodeLine{136 \textcolor{comment}{ * https://en.wikipedia.org/wiki/Apple\_Remote}}
\DoxyCodeLine{137 \textcolor{comment}{ * https://gist.github.com/darconeous/4437f79a34e3b6441628}}
\DoxyCodeLine{138 \textcolor{comment}{ * @param aAddress is the DeviceId*}}
\DoxyCodeLine{139 \textcolor{comment}{ * @param aIsRepeat if true, send only one repeat frame without leading and trailing space}}
\DoxyCodeLine{140 \textcolor{comment}{ */}}
\DoxyCodeLine{141 \textcolor{keywordtype}{void} IRsend::sendApple(uint8\_t aDeviceId, uint8\_t aCommand, uint\_fast8\_t aNumberOfRepeats, \textcolor{keywordtype}{bool} aIsRepeat) \{}
\DoxyCodeLine{142 }
\DoxyCodeLine{143     \mbox{\hyperlink{union_long_union}{LongUnion}} tRawData;}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     \textcolor{comment}{// Address 16 bit LSB first}}
\DoxyCodeLine{146     tRawData.UWord.LowWord = APPLE\_ADDRESS;}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{// send Apple code and then 8 command bits LSB first}}
\DoxyCodeLine{149     tRawData.UByte.MidHighByte = aCommand;}
\DoxyCodeLine{150     tRawData.UByte.HighByte = aDeviceId; \textcolor{comment}{// e.g. 0xD7}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152     sendNECRaw(tRawData.ULong, aNumberOfRepeats, aIsRepeat);}
\DoxyCodeLine{153 \}}
\DoxyCodeLine{154 }
\DoxyCodeLine{155 \textcolor{keywordtype}{void} IRsend::sendNECRaw(uint32\_t aRawData, uint\_fast8\_t aNumberOfRepeats, \textcolor{keywordtype}{bool} aIsRepeat) \{}
\DoxyCodeLine{156     \textcolor{keywordflow}{if} (aIsRepeat) \{}
\DoxyCodeLine{157         sendNECRepeat();}
\DoxyCodeLine{158         \textcolor{keywordflow}{return};}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160     \textcolor{comment}{// Set IR carrier frequency}}
\DoxyCodeLine{161     \mbox{\hyperlink{group___sending_ga42c04af63d252b320c017ffa2bfc90e5}{enableIROut}}(NEC\_KHZ);}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     \textcolor{comment}{// Header}}
\DoxyCodeLine{164     \mbox{\hyperlink{group___sending_ga7328943560a5f60f4e9e13d677716674}{mark}}(NEC\_HEADER\_MARK);}
\DoxyCodeLine{165     \mbox{\hyperlink{group___sending_ga6a653dc4b2f718ce16a2ae87abdc2527}{space}}(NEC\_HEADER\_SPACE);}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{comment}{// LSB first + stop bit}}
\DoxyCodeLine{168     \mbox{\hyperlink{group___sending_ga6904a411999a4c9f7306dba49851eb7b}{sendPulseDistanceWidthData}}(NEC\_BIT\_MARK, NEC\_ONE\_SPACE, NEC\_BIT\_MARK, NEC\_ZERO\_SPACE, aRawData, NEC\_BITS, PROTOCOL\_IS\_LSB\_FIRST,}
\DoxyCodeLine{169     SEND\_STOP\_BIT);}
\DoxyCodeLine{170 }
\DoxyCodeLine{171     \textcolor{keywordflow}{for} (uint\_fast8\_t i = 0; i < aNumberOfRepeats; ++i) \{}
\DoxyCodeLine{172         \textcolor{comment}{// send repeat in a 110 ms raster}}
\DoxyCodeLine{173         \textcolor{keywordflow}{if} (i == 0) \{}
\DoxyCodeLine{174             delay(NEC\_REPEAT\_SPACE / MICROS\_IN\_ONE\_MILLI);}
\DoxyCodeLine{175         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{176             delay((NEC\_REPEAT\_PERIOD -\/ NEC\_REPEAT\_DURATION) / MICROS\_IN\_ONE\_MILLI);}
\DoxyCodeLine{177         \}}
\DoxyCodeLine{178         \textcolor{comment}{// send repeat}}
\DoxyCodeLine{179         sendNECRepeat();}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{181 \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183 \textcolor{comment}{//+=============================================================================}}
\DoxyCodeLine{184 \textcolor{comment}{// NECs have a repeat only 4 items long}}
\DoxyCodeLine{185 \textcolor{comment}{//}}
\DoxyCodeLine{186 \textcolor{comment}{/*}}
\DoxyCodeLine{187 \textcolor{comment}{ * First check for right data length}}
\DoxyCodeLine{188 \textcolor{comment}{ * Next check start bit}}
\DoxyCodeLine{189 \textcolor{comment}{ * Next try the decode}}
\DoxyCodeLine{190 \textcolor{comment}{ * Last check stop bit}}
\DoxyCodeLine{191 \textcolor{comment}{ *}}
\DoxyCodeLine{192 \textcolor{comment}{ * Decodes also Apple}}
\DoxyCodeLine{193 \textcolor{comment}{ */}}
\DoxyCodeLine{194 \textcolor{keywordtype}{bool} IRrecv::decodeNEC() \{}
\DoxyCodeLine{195 }
\DoxyCodeLine{196     \textcolor{comment}{// Check we have the right amount of data (68). The +4 is for initial gap, start bit mark and space + stop bit mark.}}
\DoxyCodeLine{197     \textcolor{keywordflow}{if} (decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}} != ((2 * NEC\_BITS) + 4) \&\& (decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}} != 4)) \{}
\DoxyCodeLine{198         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(F(\textcolor{stringliteral}{"{}NEC: "{}}));}
\DoxyCodeLine{199         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Data length="{}});}
\DoxyCodeLine{200         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}});}
\DoxyCodeLine{201         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{} is not 68 or 4"{}});}
\DoxyCodeLine{202         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{203     \}}
\DoxyCodeLine{204 }
\DoxyCodeLine{205     \textcolor{comment}{// Check header "{}mark"{} this must be done for repeat and data}}
\DoxyCodeLine{206     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[1], NEC\_HEADER\_MARK)) \{}
\DoxyCodeLine{207         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{208     \}}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     \textcolor{comment}{// Check for repeat -\/ here we have another header space length}}
\DoxyCodeLine{211     \textcolor{keywordflow}{if} (decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}} == 4) \{}
\DoxyCodeLine{212         \textcolor{keywordflow}{if} (\mbox{\hyperlink{group___receiving_ga7902b620f6c01463b5b6e50ef604ac8b}{matchSpace}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[2], NEC\_REPEAT\_HEADER\_SPACE)}
\DoxyCodeLine{213                 \&\& \mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[3], NEC\_BIT\_MARK)) \{}
\DoxyCodeLine{214             decodedIRData.\mbox{\hyperlink{struct_i_r_data_aaaad48fc0d90e5c6daec601987848a51}{flags}} = IRDATA\_FLAGS\_IS\_REPEAT | IRDATA\_FLAGS\_IS\_LSB\_FIRST;}
\DoxyCodeLine{215             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a1255a5b7d704d34fda83dcabcb903d4c}{address}} = lastDecodedAddress;}
\DoxyCodeLine{216             decodedIRData.\mbox{\hyperlink{struct_i_r_data_ab0ce2b36765ea429e8c4bfa0706a45e7}{command}} = lastDecodedCommand;}
\DoxyCodeLine{217             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = lastDecodedProtocol;}
\DoxyCodeLine{218             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{219         \}}
\DoxyCodeLine{220         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{221     \}}
\DoxyCodeLine{222 }
\DoxyCodeLine{223     \textcolor{comment}{// Check command header space}}
\DoxyCodeLine{224     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga7902b620f6c01463b5b6e50ef604ac8b}{matchSpace}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[2], NEC\_HEADER\_SPACE)) \{}
\DoxyCodeLine{225         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(F(\textcolor{stringliteral}{"{}NEC: "{}}));}
\DoxyCodeLine{226         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Header space length is wrong"{}}));}
\DoxyCodeLine{227         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{228     \}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_gaf8c9cdb5f7280043a552f22265bdb2d5}{decodePulseDistanceData}}(NEC\_BITS, 3, NEC\_BIT\_MARK, NEC\_ONE\_SPACE, NEC\_ZERO\_SPACE, PROTOCOL\_IS\_LSB\_FIRST)) \{}
\DoxyCodeLine{231         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(F(\textcolor{stringliteral}{"{}NEC: "{}}));}
\DoxyCodeLine{232         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Decode failed"{}}));}
\DoxyCodeLine{233         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{234     \}}
\DoxyCodeLine{235 }
\DoxyCodeLine{236     \textcolor{comment}{// Stop bit}}
\DoxyCodeLine{237     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[3 + (2 * NEC\_BITS)], NEC\_BIT\_MARK)) \{}
\DoxyCodeLine{238         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(F(\textcolor{stringliteral}{"{}NEC: "{}}));}
\DoxyCodeLine{239         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Stop bit mark length is wrong"{}}));}
\DoxyCodeLine{240         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{241     \}}
\DoxyCodeLine{242 }
\DoxyCodeLine{243     \textcolor{comment}{// Success}}
\DoxyCodeLine{244 \textcolor{comment}{//    decodedIRData.flags = IRDATA\_FLAGS\_IS\_LSB\_FIRST; // Not required, since this is the start value}}
\DoxyCodeLine{245     \mbox{\hyperlink{union_long_union}{LongUnion}} tValue;}
\DoxyCodeLine{246     tValue.ULong = decodedIRData.\mbox{\hyperlink{struct_i_r_data_aeca55ebf36bf919312a933597b8734d8}{decodedRawData}};}
\DoxyCodeLine{247     decodedIRData.\mbox{\hyperlink{struct_i_r_data_ab0ce2b36765ea429e8c4bfa0706a45e7}{command}} = tValue.UByte.MidHighByte; \textcolor{comment}{// 8 bit}}
\DoxyCodeLine{248     \textcolor{comment}{// Address}}
\DoxyCodeLine{249     \textcolor{keywordflow}{if} (tValue.UWord.LowWord == APPLE\_ADDRESS) \{}
\DoxyCodeLine{250         \textcolor{comment}{/*}}
\DoxyCodeLine{251 \textcolor{comment}{         * Apple}}
\DoxyCodeLine{252 \textcolor{comment}{         */}}
\DoxyCodeLine{253         decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = APPLE;}
\DoxyCodeLine{254         decodedIRData.\mbox{\hyperlink{struct_i_r_data_a1255a5b7d704d34fda83dcabcb903d4c}{address}} = tValue.UByte.HighByte;}
\DoxyCodeLine{255 }
\DoxyCodeLine{256     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{257         \textcolor{comment}{/*}}
\DoxyCodeLine{258 \textcolor{comment}{         * NEC}}
\DoxyCodeLine{259 \textcolor{comment}{         */}}
\DoxyCodeLine{260         \textcolor{keywordflow}{if} (tValue.UByte.LowByte == (uint8\_t) (\string~tValue.UByte.MidLowByte)) \{}
\DoxyCodeLine{261             \textcolor{comment}{// standard 8 bit address NEC protocol}}
\DoxyCodeLine{262             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a1255a5b7d704d34fda83dcabcb903d4c}{address}} = tValue.UByte.LowByte; \textcolor{comment}{// first 8 bit}}
\DoxyCodeLine{263         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{264             \textcolor{comment}{// extended NEC protocol}}
\DoxyCodeLine{265             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a1255a5b7d704d34fda83dcabcb903d4c}{address}} = tValue.UWord.LowWord; \textcolor{comment}{// first 16 bit}}
\DoxyCodeLine{266         \}}
\DoxyCodeLine{267         \textcolor{comment}{// Check for command if it is 8 bit NEC or 16 bit ONKYO}}
\DoxyCodeLine{268         \textcolor{keywordflow}{if} (tValue.UByte.MidHighByte == (uint8\_t) (\string~tValue.UByte.HighByte)) \{}
\DoxyCodeLine{269             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = NEC;}
\DoxyCodeLine{270         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{271             decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = ONKYO;}
\DoxyCodeLine{272             decodedIRData.\mbox{\hyperlink{struct_i_r_data_ab0ce2b36765ea429e8c4bfa0706a45e7}{command}} = tValue.UWord.HighWord; \textcolor{comment}{// 16 bit command}}
\DoxyCodeLine{273 }
\DoxyCodeLine{274             \textcolor{comment}{/*}}
\DoxyCodeLine{275 \textcolor{comment}{             * Old NEC plausibility check below, now it is just ONKYO :-\/)}}
\DoxyCodeLine{276 \textcolor{comment}{             */}}
\DoxyCodeLine{277 \textcolor{comment}{//            IR\_DEBUG\_PRINT(F("{}NEC: "{}));}}
\DoxyCodeLine{278 \textcolor{comment}{//            IR\_DEBUG\_PRINT(F("{}Command=0x"{}));}}
\DoxyCodeLine{279 \textcolor{comment}{//            IR\_DEBUG\_PRINT(tValue.UByte.MidHighByte, HEX);}}
\DoxyCodeLine{280 \textcolor{comment}{//            IR\_DEBUG\_PRINT(F("{} is not inverted value of 0x"{}));}}
\DoxyCodeLine{281 \textcolor{comment}{//            IR\_DEBUG\_PRINTLN(tValue.UByte.HighByte, HEX);}}
\DoxyCodeLine{282 \textcolor{comment}{//            decodedIRData.flags = IRDATA\_FLAGS\_PARITY\_FAILED | IRDATA\_FLAGS\_IS\_LSB\_FIRST;}}
\DoxyCodeLine{283         \}}
\DoxyCodeLine{284     \}}
\DoxyCodeLine{285     decodedIRData.\mbox{\hyperlink{struct_i_r_data_a945c41b8463a36cf00b0f38b0aa73200}{numberOfBits}} = NEC\_BITS;}
\DoxyCodeLine{286 }
\DoxyCodeLine{287     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{288 \}}
\DoxyCodeLine{289 }
\DoxyCodeLine{290 \textcolor{keywordtype}{bool} IRrecv::decodeNECMSB(\mbox{\hyperlink{structdecode__results}{decode\_results}} *aResults) \{}
\DoxyCodeLine{291     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = 1;  \textcolor{comment}{// Index in to results; Skip first space.}}
\DoxyCodeLine{292 }
\DoxyCodeLine{293 \textcolor{comment}{// Check header "{}mark"{}}}
\DoxyCodeLine{294     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(aResults-\/>rawbuf[offset], NEC\_HEADER\_MARK)) \{}
\DoxyCodeLine{295         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{296     \}}
\DoxyCodeLine{297     offset++;}
\DoxyCodeLine{298 }
\DoxyCodeLine{299 \textcolor{comment}{// Check for repeat}}
\DoxyCodeLine{300     \textcolor{keywordflow}{if} ((aResults-\/>rawlen == 4) \&\& \mbox{\hyperlink{group___receiving_ga7902b620f6c01463b5b6e50ef604ac8b}{matchSpace}}(aResults-\/>rawbuf[offset], NEC\_REPEAT\_HEADER\_SPACE)}
\DoxyCodeLine{301             \&\& \mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(aResults-\/>rawbuf[offset + 1], NEC\_BIT\_MARK)) \{}
\DoxyCodeLine{302         aResults-\/>bits = 0;}
\DoxyCodeLine{303         aResults-\/>value = 0xFFFFFFFF;}
\DoxyCodeLine{304         decodedIRData.\mbox{\hyperlink{struct_i_r_data_aaaad48fc0d90e5c6daec601987848a51}{flags}} |= IRDATA\_FLAGS\_IS\_REPEAT;}
\DoxyCodeLine{305         decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = NEC;}
\DoxyCodeLine{306         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{307     \}}
\DoxyCodeLine{308 }
\DoxyCodeLine{309     \textcolor{comment}{// Check we have the right amount of data (32). +4 for initial gap, start bit mark and space + stop bit mark}}
\DoxyCodeLine{310     \textcolor{keywordflow}{if} (aResults-\/>rawlen != (2 * NEC\_BITS) + 4) \{}
\DoxyCodeLine{311         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}NEC MSB: "{}});}
\DoxyCodeLine{312         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Data length="{}});}
\DoxyCodeLine{313         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(aResults-\/>rawlen);}
\DoxyCodeLine{314         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{} is not 68"{}});}
\DoxyCodeLine{315         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{316     \}}
\DoxyCodeLine{317 }
\DoxyCodeLine{318 \textcolor{comment}{// Check header "{}space"{}}}
\DoxyCodeLine{319     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga7902b620f6c01463b5b6e50ef604ac8b}{matchSpace}}(aResults-\/>rawbuf[offset], NEC\_HEADER\_SPACE)) \{}
\DoxyCodeLine{320         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}NEC MSB: "{}});}
\DoxyCodeLine{321         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}Header space length is wrong"{}});}
\DoxyCodeLine{322         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{323     \}}
\DoxyCodeLine{324     offset++;}
\DoxyCodeLine{325 }
\DoxyCodeLine{326     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_gaf8c9cdb5f7280043a552f22265bdb2d5}{decodePulseDistanceData}}(NEC\_BITS, offset, NEC\_BIT\_MARK, NEC\_ONE\_SPACE, NEC\_ZERO\_SPACE, PROTOCOL\_IS\_MSB\_FIRST)) \{}
\DoxyCodeLine{327         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(F(\textcolor{stringliteral}{"{}NEC MSB: "{}}));}
\DoxyCodeLine{328         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Decode failed"{}}));}
\DoxyCodeLine{329         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{330     \}}
\DoxyCodeLine{331 }
\DoxyCodeLine{332     \textcolor{comment}{// Stop bit}}
\DoxyCodeLine{333     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(aResults-\/>rawbuf[offset + (2 * NEC\_BITS)], NEC\_BIT\_MARK)) \{}
\DoxyCodeLine{334         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}NEC MSB: "{}});}
\DoxyCodeLine{335         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Stop bit mark length is wrong"{}}));}
\DoxyCodeLine{336         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{337     \}}
\DoxyCodeLine{338 }
\DoxyCodeLine{339 \textcolor{comment}{// Success}}
\DoxyCodeLine{340     aResults-\/>value = decodedIRData.\mbox{\hyperlink{struct_i_r_data_aeca55ebf36bf919312a933597b8734d8}{decodedRawData}};}
\DoxyCodeLine{341     aResults-\/>bits = NEC\_BITS;}
\DoxyCodeLine{342     aResults-\/>decode\_type = NEC;}
\DoxyCodeLine{343     decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = NEC;}
\DoxyCodeLine{344 }
\DoxyCodeLine{345     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{346 \}}
\DoxyCodeLine{347 }
\DoxyCodeLine{358 \textcolor{keywordtype}{void} \mbox{\hyperlink{group___decoder_ga0184d3edbfe2659b12fc157c3be0cd63}{IRsend::sendNECMSB}}(uint32\_t data, uint8\_t nbits, \textcolor{keywordtype}{bool} repeat) \{}
\DoxyCodeLine{359     \textcolor{comment}{// Set IR carrier frequency}}
\DoxyCodeLine{360     \mbox{\hyperlink{group___sending_ga42c04af63d252b320c017ffa2bfc90e5}{enableIROut}}(NEC\_KHZ);}
\DoxyCodeLine{361 }
\DoxyCodeLine{362     \textcolor{keywordflow}{if} (data == 0xFFFFFFFF || repeat) \{}
\DoxyCodeLine{363         sendNECRepeat();}
\DoxyCodeLine{364         \textcolor{keywordflow}{return};}
\DoxyCodeLine{365     \}}
\DoxyCodeLine{366 }
\DoxyCodeLine{367     \textcolor{comment}{// Header}}
\DoxyCodeLine{368     \mbox{\hyperlink{group___sending_ga7328943560a5f60f4e9e13d677716674}{mark}}(NEC\_HEADER\_MARK);}
\DoxyCodeLine{369     \mbox{\hyperlink{group___sending_ga6a653dc4b2f718ce16a2ae87abdc2527}{space}}(NEC\_HEADER\_SPACE);}
\DoxyCodeLine{370 }
\DoxyCodeLine{371     \textcolor{comment}{// Old version with MSB first Data + stop bit}}
\DoxyCodeLine{372     \mbox{\hyperlink{group___sending_ga6904a411999a4c9f7306dba49851eb7b}{sendPulseDistanceWidthData}}(NEC\_BIT\_MARK, NEC\_ONE\_SPACE, NEC\_BIT\_MARK, NEC\_ZERO\_SPACE, data, nbits, PROTOCOL\_IS\_MSB\_FIRST,}
\DoxyCodeLine{373     SEND\_STOP\_BIT);}
\DoxyCodeLine{374 \}}
\DoxyCodeLine{375 }
\DoxyCodeLine{377 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{378 \textcolor{preprocessor}{\#pragma once}}

\end{DoxyCode}
