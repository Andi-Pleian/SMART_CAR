\hypertarget{ir___lego_8hpp_source}{}\doxysection{ir\+\_\+\+Lego.\+hpp}
\label{ir___lego_8hpp_source}\index{IRRemote/ir\_Lego.hpp@{IRRemote/ir\_Lego.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * ir\_Lego.hpp}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Contains functions for receiving and sending Lego Power Functions IR Protocol}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ *  This file is part of Arduino-\/IRremote https://github.com/Arduino-\/IRremote/Arduino-\/IRremote.}}
\DoxyCodeLine{7 \textcolor{comment}{ *}}
\DoxyCodeLine{8 \textcolor{comment}{ ************************************************************************************}}
\DoxyCodeLine{9 \textcolor{comment}{ * MIT License}}
\DoxyCodeLine{10 \textcolor{comment}{ *}}
\DoxyCodeLine{11 \textcolor{comment}{ * Copyright (c) 2020-\/2021 Armin Joachimsmeyer}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * Permission is hereby granted, free of charge, to any person obtaining a copy}}
\DoxyCodeLine{14 \textcolor{comment}{ * of this software and associated documentation files (the "{}Software"{}), to deal}}
\DoxyCodeLine{15 \textcolor{comment}{ * in the Software without restriction, including without limitation the rights}}
\DoxyCodeLine{16 \textcolor{comment}{ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}}
\DoxyCodeLine{17 \textcolor{comment}{ * copies of the Software, and to permit persons to whom the Software is furnished}}
\DoxyCodeLine{18 \textcolor{comment}{ * to do so, subject to the following conditions:}}
\DoxyCodeLine{19 \textcolor{comment}{ *}}
\DoxyCodeLine{20 \textcolor{comment}{ * The above copyright notice and this permission notice shall be included in all}}
\DoxyCodeLine{21 \textcolor{comment}{ * copies or substantial portions of the Software.}}
\DoxyCodeLine{22 \textcolor{comment}{ *}}
\DoxyCodeLine{23 \textcolor{comment}{ * THE SOFTWARE IS PROVIDED "{}AS IS"{}, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,}}
\DoxyCodeLine{24 \textcolor{comment}{ * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A}}
\DoxyCodeLine{25 \textcolor{comment}{ * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT}}
\DoxyCodeLine{26 \textcolor{comment}{ * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF}}
\DoxyCodeLine{27 \textcolor{comment}{ * CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE}}
\DoxyCodeLine{28 \textcolor{comment}{ * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.}}
\DoxyCodeLine{29 \textcolor{comment}{ *}}
\DoxyCodeLine{30 \textcolor{comment}{ ************************************************************************************}}
\DoxyCodeLine{31 \textcolor{comment}{ */}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#ifndef IR\_LEGO\_HPP}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define IR\_LEGO\_HPP}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <Arduino.h>}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{comment}{//\#define DEBUG // Activate this for lots of lovely debug output from this decoder.}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_i_rremote_int_8h}{IRremoteInt.h}}"{}} \textcolor{comment}{// evaluates the DEBUG for IR\_DEBUG\_PRINT}}
\DoxyCodeLine{39 }
\DoxyCodeLine{43 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{44 \textcolor{comment}{//         L       EEEEEE   EEEE    OOOO}}
\DoxyCodeLine{45 \textcolor{comment}{//         L       E       E       O    O}}
\DoxyCodeLine{46 \textcolor{comment}{//         L       EEEE    E  EEE  O    O}}
\DoxyCodeLine{47 \textcolor{comment}{//         L       E       E    E  O    O}}
\DoxyCodeLine{48 \textcolor{comment}{//         LLLLLL  EEEEEE   EEEE    OOOO}}
\DoxyCodeLine{49 \textcolor{comment}{//==============================================================================}}
\DoxyCodeLine{50 \textcolor{comment}{// from LEGO Power Functions RC Manual 26.02.2010 Version 1.20}}
\DoxyCodeLine{51 \textcolor{comment}{// https://github.com/jurriaan/Arduino-\/PowerFunctions/raw/master/LEGO\_Power\_Functions\_RC\_v120.pdf}}
\DoxyCodeLine{52 \textcolor{comment}{// https://oberguru.net/elektronik/ir/codes/lego\_power\_functions\_train.lircd.conf}}
\DoxyCodeLine{53 \textcolor{comment}{//}}
\DoxyCodeLine{54 \textcolor{comment}{// To ensure correct detection of IR messages six 38 kHz cycles are transmitted as mark.}}
\DoxyCodeLine{55 \textcolor{comment}{// Low bit consists of 6 cycles of IR and 10 “cycles” of pause,}}
\DoxyCodeLine{56 \textcolor{comment}{// high bit of 6 cycles IR and 21 “cycles” of pause and start bit of 6 cycles IR and 39 “cycles” of pause.}}
\DoxyCodeLine{57 \textcolor{comment}{// Low bit range 316 -\/ 526 us}}
\DoxyCodeLine{58 \textcolor{comment}{// High bit range 526 – 947 us}}
\DoxyCodeLine{59 \textcolor{comment}{// Start/stop bit range 947 – 1579 us}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{comment}{// If tm is the maximum message length (16ms) and Ch is the channel number, then}}
\DoxyCodeLine{62 \textcolor{comment}{// The delay before transmitting the first message is: (4 – Ch)*tm}}
\DoxyCodeLine{63 \textcolor{comment}{// The time from start to start for the next 2 messages is: 5*tm}}
\DoxyCodeLine{64 \textcolor{comment}{// The time from start to start for the following messages is: (6 + 2*Ch)*tm}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{comment}{// Supported Devices}}
\DoxyCodeLine{67 \textcolor{comment}{// LEGO Power Functions IR Receiver 8884}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{comment}{// MSB first, 1 start bit + 4 bit channel, 4 bit mode + 4 bit command + 4 bit parity + 1 stop bit.}}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#define LEGO\_CHANNEL\_BITS       4}}
\DoxyCodeLine{71 \textcolor{preprocessor}{\#define LEGO\_MODE\_BITS          4}}
\DoxyCodeLine{72 \textcolor{preprocessor}{\#define LEGO\_COMMAND\_BITS       4}}
\DoxyCodeLine{73 \textcolor{preprocessor}{\#define LEGO\_PARITY\_BITS        4}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{preprocessor}{\#define LEGO\_BITS               (LEGO\_CHANNEL\_BITS + LEGO\_MODE\_BITS + LEGO\_COMMAND\_BITS + LEGO\_PARITY\_BITS)}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77 \textcolor{preprocessor}{\#define LEGO\_HEADER\_MARK        158    }\textcolor{comment}{//  6 cycles}}
\DoxyCodeLine{78 \textcolor{preprocessor}{\#define LEGO\_HEADER\_SPACE       1026   }\textcolor{comment}{// 39 cycles}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{preprocessor}{\#define LEGO\_BIT\_MARK           158    }\textcolor{comment}{//  6 cycles}}
\DoxyCodeLine{81 \textcolor{preprocessor}{\#define LEGO\_ONE\_SPACE          553    }\textcolor{comment}{// 21 cycles}}
\DoxyCodeLine{82 \textcolor{preprocessor}{\#define LEGO\_ZERO\_SPACE         263    }\textcolor{comment}{// 10 cycles}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{preprocessor}{\#define LEGO\_AVERAGE\_DURATION   11000 }\textcolor{comment}{// LEGO\_HEADER\_MARK + LEGO\_HEADER\_SPACE  + 16 * 600 + 158}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{preprocessor}{\#define LEGO\_AUTO\_REPEAT\_PERIOD\_MIN 110000 }\textcolor{comment}{// Every frame is auto repeated 5 times.}}
\DoxyCodeLine{87 \textcolor{preprocessor}{\#define LEGO\_AUTO\_REPEAT\_PERIOD\_MAX 230000 }\textcolor{comment}{// space for channel 3}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89 \textcolor{comment}{/*}}
\DoxyCodeLine{90 \textcolor{comment}{ * Compatibility function for legacy code, this calls the send raw data function}}
\DoxyCodeLine{91 \textcolor{comment}{ */}}
\DoxyCodeLine{92 \textcolor{keywordtype}{void} IRsend::sendLegoPowerFunctions(uint16\_t aRawData, \textcolor{keywordtype}{bool} aDoSend5Times) \{}
\DoxyCodeLine{93     sendLegoPowerFunctions(aRawData, (aRawData >> (LEGO\_MODE\_BITS + LEGO\_COMMAND\_BITS + LEGO\_PARITY\_BITS)) \& 0x3, aDoSend5Times);}
\DoxyCodeLine{94 \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 \textcolor{comment}{/*}}
\DoxyCodeLine{97 \textcolor{comment}{ * Here we process the structured data, and call the send raw data function}}
\DoxyCodeLine{98 \textcolor{comment}{ */}}
\DoxyCodeLine{99 \textcolor{keywordtype}{void} IRsend::sendLegoPowerFunctions(uint8\_t aChannel, uint8\_t aCommand, uint8\_t aMode, \textcolor{keywordtype}{bool} aDoSend5Times) \{}
\DoxyCodeLine{100     aChannel \&= 0x0F; \textcolor{comment}{// allow toggle and escape bits too}}
\DoxyCodeLine{101     aCommand \&= 0x0F;}
\DoxyCodeLine{102     aMode \&= 0x0F;}
\DoxyCodeLine{103     uint8\_t tParity = 0xF \string^ aChannel \string^ aMode \string^ aCommand;}
\DoxyCodeLine{104     \textcolor{comment}{// send 4 bit channel, 4 bit mode, 4 bit command, 4 bit parity}}
\DoxyCodeLine{105     uint16\_t tRawData = (((aChannel << LEGO\_MODE\_BITS) | aMode) << (LEGO\_COMMAND\_BITS + LEGO\_PARITY\_BITS))}
\DoxyCodeLine{106             | (aCommand << LEGO\_PARITY\_BITS) | tParity;}
\DoxyCodeLine{107     sendLegoPowerFunctions(tRawData, aChannel, aDoSend5Times);}
\DoxyCodeLine{108 \}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \textcolor{keywordtype}{void} IRsend::sendLegoPowerFunctions(uint16\_t aRawData, uint8\_t aChannel, \textcolor{keywordtype}{bool} aDoSend5Times) \{}
\DoxyCodeLine{111     \mbox{\hyperlink{group___sending_ga42c04af63d252b320c017ffa2bfc90e5}{enableIROut}}(38);}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}sendLego aRawData=0x"{}});}
\DoxyCodeLine{114     \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(aRawData, HEX);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116     aChannel \&= 0x03; \textcolor{comment}{// we have 4 channels}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     uint\_fast8\_t tNumberOfCommands = 1;}
\DoxyCodeLine{119     \textcolor{keywordflow}{if} (aDoSend5Times) \{}
\DoxyCodeLine{120         tNumberOfCommands = 5;}
\DoxyCodeLine{121     \}}
\DoxyCodeLine{122 \textcolor{comment}{// required for repeat timing, see http://www.hackvandedam.nl/blog/?page\_id=559}}
\DoxyCodeLine{123     uint8\_t tRepeatPeriod = (110 -\/ (LEGO\_AVERAGE\_DURATION / MICROS\_IN\_ONE\_MILLI)) + (aChannel * 40); \textcolor{comment}{// from 100 to 220}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{keywordflow}{while} (tNumberOfCommands > 0) \{}
\DoxyCodeLine{126 }
\DoxyCodeLine{127         \textcolor{comment}{// Header}}
\DoxyCodeLine{128         \mbox{\hyperlink{group___sending_ga7328943560a5f60f4e9e13d677716674}{mark}}(LEGO\_HEADER\_MARK);}
\DoxyCodeLine{129         \mbox{\hyperlink{group___sending_ga6a653dc4b2f718ce16a2ae87abdc2527}{space}}(LEGO\_HEADER\_SPACE);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131         \mbox{\hyperlink{group___sending_ga6904a411999a4c9f7306dba49851eb7b}{sendPulseDistanceWidthData}}(LEGO\_BIT\_MARK, LEGO\_ONE\_SPACE, LEGO\_BIT\_MARK, LEGO\_ZERO\_SPACE, aRawData, LEGO\_BITS, PROTOCOL\_IS\_MSB\_FIRST,}
\DoxyCodeLine{132         SEND\_STOP\_BIT);}
\DoxyCodeLine{133 }
\DoxyCodeLine{134         tNumberOfCommands-\/-\/;}
\DoxyCodeLine{135         \textcolor{comment}{// skip last delay!}}
\DoxyCodeLine{136         \textcolor{keywordflow}{if} (tNumberOfCommands > 0) \{}
\DoxyCodeLine{137             \textcolor{comment}{// send repeated command with a fixed space gap}}
\DoxyCodeLine{138             delay(tRepeatPeriod);}
\DoxyCodeLine{139         \}}
\DoxyCodeLine{140     \}}
\DoxyCodeLine{141 \}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 \textcolor{comment}{/*}}
\DoxyCodeLine{144 \textcolor{comment}{ * Mode is stored in the upper nibble of command}}
\DoxyCodeLine{145 \textcolor{comment}{ */}}
\DoxyCodeLine{146 \textcolor{keywordtype}{bool} IRrecv::decodeLegoPowerFunctions() \{}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{// Check header "{}mark"{}}}
\DoxyCodeLine{149     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[1], LEGO\_HEADER\_MARK)) \{}
\DoxyCodeLine{150         \textcolor{comment}{// no debug output, since this check is mainly to determine the received protocol}}
\DoxyCodeLine{151         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{152     \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154     \textcolor{comment}{// Check we have enough data -\/ +4 for initial gap, start bit mark and space + stop bit mark}}
\DoxyCodeLine{155     \textcolor{keywordflow}{if} (decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}} != (2 * LEGO\_BITS) + 4) \{}
\DoxyCodeLine{156         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}LEGO: "{}});}
\DoxyCodeLine{157         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Data length="{}});}
\DoxyCodeLine{158         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_af0571ac479d1c38c79502651b0631432}{rawlen}});}
\DoxyCodeLine{159         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{} is not 36"{}});}
\DoxyCodeLine{160         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162     \textcolor{comment}{// Check header "{}space"{}}}
\DoxyCodeLine{163     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga7902b620f6c01463b5b6e50ef604ac8b}{matchSpace}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[2], LEGO\_HEADER\_SPACE)) \{}
\DoxyCodeLine{164         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}LEGO: "{}});}
\DoxyCodeLine{165         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}Header space length is wrong"{}});}
\DoxyCodeLine{166         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{167     \}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_gaf8c9cdb5f7280043a552f22265bdb2d5}{decodePulseDistanceData}}(LEGO\_BITS, 3, LEGO\_BIT\_MARK, LEGO\_ONE\_SPACE, LEGO\_ZERO\_SPACE, PROTOCOL\_IS\_MSB\_FIRST)) \{}
\DoxyCodeLine{170         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}LEGO: "{}});}
\DoxyCodeLine{171         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(\textcolor{stringliteral}{"{}Decode failed"{}});}
\DoxyCodeLine{172         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{173     \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175     \textcolor{comment}{// Stop bit}}
\DoxyCodeLine{176     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group___receiving_ga4472564ea96b1ee10b51f594f60d7aeb}{matchMark}}(decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[3 + (2 * LEGO\_BITS)], LEGO\_BIT\_MARK)) \{}
\DoxyCodeLine{177         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}LEGO: "{}});}
\DoxyCodeLine{178         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(F(\textcolor{stringliteral}{"{}Stop bit mark length is wrong"{}}));}
\DoxyCodeLine{179         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{// Success}}
\DoxyCodeLine{183     decodedIRData.\mbox{\hyperlink{struct_i_r_data_aaaad48fc0d90e5c6daec601987848a51}{flags}} = \mbox{\hyperlink{_i_rremote_int_8h_a7f6872e6f83c0571e3150ba86428af4c}{IRDATA\_FLAGS\_IS\_MSB\_FIRST}};}
\DoxyCodeLine{184     uint16\_t tDecodedValue = decodedIRData.\mbox{\hyperlink{struct_i_r_data_aeca55ebf36bf919312a933597b8734d8}{decodedRawData}};}
\DoxyCodeLine{185     uint8\_t tToggleEscapeChannel = tDecodedValue >> (LEGO\_MODE\_BITS + LEGO\_COMMAND\_BITS + LEGO\_PARITY\_BITS);}
\DoxyCodeLine{186     uint8\_t tMode = (tDecodedValue >> (LEGO\_COMMAND\_BITS + LEGO\_PARITY\_BITS)) \& 0xF;}
\DoxyCodeLine{187     uint8\_t tData = (tDecodedValue >> LEGO\_PARITY\_BITS) \& 0xF; \textcolor{comment}{// lego calls this field "{}data"{}}}
\DoxyCodeLine{188     uint8\_t tParityReceived = tDecodedValue \& 0xF;}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{comment}{// This is parity as defined in the specifications}}
\DoxyCodeLine{191     \textcolor{comment}{// But in some scans I saw 0x9 \string^ .. as parity formula}}
\DoxyCodeLine{192     uint8\_t tParityComputed = 0xF \string^ tToggleEscapeChannel \string^ tMode \string^ tData;}
\DoxyCodeLine{193 }
\DoxyCodeLine{194     \textcolor{comment}{// parity check}}
\DoxyCodeLine{195     \textcolor{keywordflow}{if} (tParityReceived != tParityComputed) \{}
\DoxyCodeLine{196         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}LEGO: "{}});}
\DoxyCodeLine{197         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Parity is not correct. expected=0x"{}});}
\DoxyCodeLine{198         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(tParityComputed, HEX);}
\DoxyCodeLine{199         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{} received=0x"{}});}
\DoxyCodeLine{200         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(tParityReceived, HEX);}
\DoxyCodeLine{201         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}, raw=0x"{}});}
\DoxyCodeLine{202         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(tDecodedValue, HEX);}
\DoxyCodeLine{203         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}, 3 nibbles are 0x"{}});}
\DoxyCodeLine{204         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(tToggleEscapeChannel, HEX);}
\DoxyCodeLine{205         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}, 0x"{}});}
\DoxyCodeLine{206         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(tMode, HEX);}
\DoxyCodeLine{207         \mbox{\hyperlink{_i_rremote_int_8h_a093a1c04e9dd4d6845a48163554143a0}{IR\_DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}, 0x"{}});}
\DoxyCodeLine{208         \mbox{\hyperlink{_i_rremote_int_8h_aebf95fa57eb370cfe65ce6a9728b6e1f}{IR\_DEBUG\_PRINTLN}}(tData, HEX);}
\DoxyCodeLine{209         \textcolor{comment}{// might not be an error, so just continue}}
\DoxyCodeLine{210         decodedIRData.\mbox{\hyperlink{struct_i_r_data_aaaad48fc0d90e5c6daec601987848a51}{flags}} = \mbox{\hyperlink{_i_rremote_int_8h_a1a60f95f0885b1865dc5514ddd80e093}{IRDATA\_FLAGS\_PARITY\_FAILED}} | \mbox{\hyperlink{_i_rremote_int_8h_a7f6872e6f83c0571e3150ba86428af4c}{IRDATA\_FLAGS\_IS\_MSB\_FIRST}};}
\DoxyCodeLine{211     \}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213     \textcolor{comment}{/*}}
\DoxyCodeLine{214 \textcolor{comment}{     * Check for autorepeat (should happen 4 times for one press)}}
\DoxyCodeLine{215 \textcolor{comment}{     */}}
\DoxyCodeLine{216     \textcolor{keywordflow}{if} (decodedIRData.\mbox{\hyperlink{struct_i_r_data_a8d7c987d63874731ff2e1120b21a1a08}{rawDataPtr}}-\/>\mbox{\hyperlink{structirparams__struct_a7aa7b811dcc0fb5ab0da7c0bddaf97f8}{rawbuf}}[0] < (LEGO\_AUTO\_REPEAT\_PERIOD\_MAX / \mbox{\hyperlink{_i_rremote_int_8h_a1c7eebb527483c272812530caa313d20}{MICROS\_PER\_TICK}})) \{}
\DoxyCodeLine{217         decodedIRData.\mbox{\hyperlink{struct_i_r_data_aaaad48fc0d90e5c6daec601987848a51}{flags}} |= IRDATA\_FLAGS\_IS\_AUTO\_REPEAT;}
\DoxyCodeLine{218     \}}
\DoxyCodeLine{219     decodedIRData.\mbox{\hyperlink{struct_i_r_data_a1255a5b7d704d34fda83dcabcb903d4c}{address}} = tToggleEscapeChannel;}
\DoxyCodeLine{220     decodedIRData.\mbox{\hyperlink{struct_i_r_data_ab0ce2b36765ea429e8c4bfa0706a45e7}{command}} = tData | tMode << LEGO\_COMMAND\_BITS;}
\DoxyCodeLine{221     decodedIRData.\mbox{\hyperlink{struct_i_r_data_a703592faec26bab5cbe465f53ef14245}{protocol}} = LEGO\_PF;}
\DoxyCodeLine{222     decodedIRData.\mbox{\hyperlink{struct_i_r_data_a945c41b8463a36cf00b0f38b0aa73200}{numberOfBits}} = LEGO\_BITS;}
\DoxyCodeLine{223 }
\DoxyCodeLine{224     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{225 \}}
\DoxyCodeLine{226 }
\DoxyCodeLine{228 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{229 \textcolor{preprocessor}{\#pragma once}}

\end{DoxyCode}
